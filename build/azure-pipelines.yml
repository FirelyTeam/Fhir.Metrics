# Repo: FirelyTeam/Fhir.Metrics
# File: build/azure-pipelines.yml
name: build-$(Date:yyyyMMdd)$(Rev:-r)

resources:
  repositories:
    - repository: templates
      type: github
      name: FirelyTeam/azure-pipeline-templates
      endpoint: FirelyTeam 

variables:
  buildConfiguration: 'Release'

trigger:
  branches:
    include:
    - develop*
    - release*

pr:
  branches:
    include: 
    - develop*
    - hotfix/*

stages:
  - stage: build
    jobs:
    - template: build.yml@templates  # Template reference
      parameters:
        packageArtifacts: false
        pool:
          vmImage: windows-latest
             
    - template: publish-plugin.yml@templates  # Template reference
      parameters:
        pool:
          vmImage: windows-latest
  - stage: deploy
    dependsOn: build
    jobs:
    - template: deploy-plugin.yml@templates
      parameters:
        pool:
          vmImage: windows-latest      
        packageName: Fhir.Metrics
        packageDescription: 'Conversion system for physical units, with UCUM implementation'
